<?xml version="1.0"?>
<block>
  <name>Tag Bits Pack</name>
  <key>sandia_utils_tagged_bits_to_bytes</key>
  <category>[Sandia]/Sandia Utilities</category>
  <import>import sandia_utils</import>
  <make>sandia_utils.tagged_bits_to_bytes($key, $little_endian_flag, $stub_mode, $v_len, $samp_rate)</make>

	<callback>set_sample_rate($samp_rate)</callback>
	<callback>set_little_endian_flag($little_endian_flag)</callback>
	<callback>set_vlen($v_len)</callback>

  <param>
    <name>Tag Key</name>
    <key>key</key>
    <value>"BURST"</value>
    <type>string</type>
  </param>

  <param>
    <name>Stub Mode</name>
    <key>stub_mode</key>
    <type>enum</type>
    <hide>part</hide>
    <option>
      <name>Drop Stub</name>
      <key>0</key>
    </option>
    <option>
      <name>Pad Right</name>
      <key>1</key>
    </option>
    <option>
      <name>Pad Left</name>
      <key>2</key>
    </option>
  </param>

  <param>
    <name>Endianness</name>
    <key>little_endian_flag</key>
    <type>enum</type>
    <hide>part</hide>
    <option>
      <name>Little Endian</name>
      <key>True</key>
    </option>
    <option>
      <name>Big Endian</name>
      <key>False</key>
    </option>
  </param>

  <param>
    <name>Sample Rate</name>
    <key>samp_rate</key>
    <value>samp_rate</value>
    <type>float</type>
    <hide>part</hide>
  </param>

  <param>
    <name>Vector Length</name>
    <key>v_len</key>
    <value>1</value>
    <type>int</type>
    <hide>part</hide>
  </param>
  
  <sink>
    <name>in</name>
    <type>byte</type>
  </sink>

  <source>
    <name>out</name>
    <type>byte</type>
    <vlen>$v_len</vlen>
  </source>

  <doc>
  Block for packing bits into bytes, aligned to a stream tag. This block is generally used
  after a block like Correlate Access Code Tag, where a preamble is tagged in a stream of
  bits and you want to pack those bits into bytes starting at that tagged sample.

  Example:
  A bit stream has the third element tagged.
  __Tag
  1010100101

  The Tag Bits Pack block (in drop stub mode) will output one byte, with the tag.
  __Tag
  0xA5

  The Tag Bits Pack block in pad right mode will output two bytes, with the tag.
  ________Tag
  0x02,0xA5


  Time is also added to the byte sample, ralative to the sample rate.

  Stub Modes:
  Drop Stubs: drop the bits that don't fit into a byte before a tag
  Pad Right: fill in missing bits to the right
  Pad Left: fill in missing bits to the left

  Input: Bits with tags
  Output: Bytes
  </doc>

</block>
