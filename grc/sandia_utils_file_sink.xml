<?xml version="1.0"?>
<block>
  <name>File Sink</name>
  <key>sandia_utils_file_sink</key>
  <category>[Sandia]/Sandia Utilities/File Operators</category>
  <import>import sandia_utils</import>
  <make>sandia_utils.file_sink($type.str, $type.size*$vlen, $file_type, $mode, $nsamples, $rate, $directory, $name_spec)
self.$(id).set_recording($record)
self.$(id).set_gen_new_folder($create_new_dir)
self.$(id).set_second_align($align)</make>


  <callback>set_mode($mode)</callback>
  <callback>set_recording($record)</callback>
  <callback>set_nsamples($nsamples)</callback>
  <callback>set_second_align($align)</callback>
  <param_tab_order>
    <tab>General</tab>
    <tab>File Options</tab>
  </param_tab_order>

  <param>
    <name>Input Type</name>
    <key>type</key>
    <type>enum</type>
    <option>
      <name>Complex Float</name>
      <key>complex</key>
      <opt>size:gr.sizeof_gr_complex</opt>
      <opt>str:"complex"</opt>
    </option>
    <option>
      <name>Complex Short Int</name>
      <key>sc16</key>
      <opt>size:2*gr.sizeof_short</opt>
      <opt>str:"complex_int"</opt>
    </option>
    <option>
      <name>Float</name>
      <key>float</key>
      <opt>size:gr.sizeof_float</opt>
      <opt>str:"float"</opt>
    </option>
    <option>
      <name>Int</name>
      <key>int</key>
      <opt>size:gr.sizeof_int</opt>
      <opt>str:"int"</opt>
    </option>
    <option>
      <name>Short</name>
      <key>short</key>
      <opt>size:gr.sizeof_short</opt>
      <opt>str:"short"</opt>
    </option>
    <option>
      <name>Byte</name>
      <key>byte</key>
      <opt>size:gr.sizeof_char</opt>
      <opt>str:"byte"</opt>
    </option>
  </param>

  <param>
    <name>Vec Length</name>
    <key>vlen</key>
    <value>1</value>
    <type>int</type>
  </param>

  <param>
    <name>Mode</name>
    <key>mode</key>
    <value>sandia_utils.MANUAL</value>
    <type>int</type>
    <option>
      <name>Manual</name>
      <key>sandia_utils.MANUAL</key>
    </option>
    <option>
      <name>Triggered</name>
      <key>sandia_utils.TRIGGERED</key>
    </option>
  </param>

  <param>
   <name>Record?</name>
    <key>record</key>
    <value>False</value>
    <type>bool</type>
    <hide>part</hide>
    <option>
      <name>True</name>
      <key>True</key>
    </option>
    <option>
      <name>False</name>
      <key>False</key>
    </option>
  </param>

  <param>
    <name>File Type</name>
    <key>file_type</key>
    <value>raw</value>
    <type>string</type>
    <option>
      <name>Raw IQ</name>
      <key>raw</key>
    </option>
    <option>
      <name>Raw IQ + Header</name>
      <key>raw_header</key>
    </option>
    <!-- Optional packages will need to define the following variables -->
    @HAVE_BLU_GRC_DEF@
    @HAVE_COMPASS_GRC_DEF@
  </param>

  <param>
    <name>Sampling Rate</name>
    <key>rate</key>
    <value>int(samp_rate)</value>
    <type>int</type>
    <hide>part</hide>
  </param>

  <!-- Begin File Options items -->
  <param>
    <name>Directory</name>
    <key>directory</key>
    <value>""</value>
    <type>string</type>
    <tab>File Options</tab>
  </param>

  <param>
    <name>Create New Directory?</name>
    <key>create_new_dir</key>
    <value>True</value>
    <type>bool</type>
    <hide>partial</hide>
    <option>
      <name>True</name>
      <key>True</key>
    </option>
    <option>
      <name>False</name>
      <key>False</key>
    </option>
    <tab>File Options</tab>
  </param>

  <param>
    <name>File Name Specifier</name>
    <key>name_spec</key>
    <value>"%Y%m%d_%H_%M_%S_fc=%fcMHz_fs=%fskHz.dat"</value>
    <type>string</type>
    <hide>part</hide>
    <tab>File Options</tab>
  </param>

  <param>
    <name>File Length (Samples)</name>
    <key>nsamples</key>
    <value>0</value>
    <type>int</type>
    <tab>File Options</tab>
  </param>

  <param>
    <name>Align to Second Boundary?</name>
    <key>align</key>
    <value>True</value>
    <type>bool</type>
    <hide>partial</hide>
    <option>
      <name>True</name>
      <key>True</key>
    </option>
    <option>
      <name>False</name>
      <key>False</key>
    </option>
    <tab>File Options</tab>
  </param>

  <check>$vlen &gt; 0</check>
  <check>$nsamples &gt; -1</check>
  <sink>
    <name>in</name>
    <type>$type</type>
    <vlen>$vlen</vlen>
  </sink>
  <source>
    <name>msg</name>
    <type>message</type>
    <optional>1</optional>
  </source>
  <doc>This block will save data to files.  File length specified in number
of samples, where 0 will result in a single file being generated.  Successive
files increment time and file number accordingly.

A new folder can be generated at the start of a new collect.  The folder name
will have the format:

  YYYYMMDD/HH_MM_SS

where Y = year, M = month(00-12), D = day (00-31), HH = hour (00-23),
MM = minute (00-59), and SS = second (00-60)

File names can be specified using all conversion specifications supported by
strftime.  Additional the following converation specifications can be used:

  %fcM      Collection center frequency in MHz
  %fck      Collection center frequency in kHz
  %fcc      Collection center frequency in Hz
  %fsM      Collection sample rate in MHz
  %fsk      Collection sample rate in kHz
  %fsc      Collection sample rate in Hz
  %fd       Generated file number.  Modifiers in the standard form (0,N) can
            be specified to determine the number of files generated.  For
            example, %03fd will wrap after 1000 files, prepending zeros to ensure
            3 characters per file number.

</doc>
</block>
